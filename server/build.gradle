buildscript {
    repositories {
        mavenCentral()
    }
}
plugins {
    id 'de.undercouch.download' version '4.0.1'
    id 'org.springframework.boot' version '2.2.2.RELEASE'
    id 'io.spring.dependency-management' version '1.0.8.RELEASE'
    id 'java'
}

def versions = [
    java: '11',
    guava: '28.1-jre',
    hibernate_search: '5.11.3.Final',
    lucene: '5.5.5'
]

sourceCompatibility = versions.java

repositories {
    mavenCentral()
}

dependencies {
	implementation "org.springframework.boot:spring-boot-starter-web"
	implementation "org.springframework.boot:spring-boot-starter-data-jpa"
    implementation "org.springframework.boot:spring-boot-starter-data-elasticsearch"
    implementation "com.google.guava:guava:${versions.guava}"
	runtimeOnly "org.postgresql:postgresql"
    runtimeOnly "org.springframework.boot:spring-boot-devtools"
	testImplementation("org.springframework.boot:spring-boot-starter-test") {
		exclude group: "org.junit.vintage", module: "junit-vintage-engine"
	}
}

task runServer(type: JavaExec) {
    classpath = sourceSets.main.runtimeClasspath
    main = 'org.eclipse.openvsx.RegistryApplication'
}


// Download some extensions for testing
task downloadTestExtensions {
    doLast {
        download {
            src "https://github.com/microsoft/vscode-python/releases/download/2019.9.34911/ms-python-release.vsix"
            dest "${buildDir}/test-extensions/python-2019.9.34911.vsix"
        }
        download {
            src "https://github.com/microsoft/vscode-python/releases/download/2019.10.41019/ms-python-release.vsix"
            dest "${buildDir}/test-extensions/python-2019.10.41019.vsix"
        }
        download {
            src "https://github.com/microsoft/vscode-python/releases/download/2019.10.44104/ms-python-release.vsix"
            dest "${buildDir}/test-extensions/python-2019.10.44104.vsix"
        }
        download {
            src "https://github.com/microsoft/vscode-cpptools/releases/download/0.26.0/cpptools-linux.vsix"
            dest "${buildDir}/test-extensions/cpptools-0.26.0.vsix"
        }
        download {
            src "https://github.com/microsoft/vscode-cpptools/releases/download/0.26.1/cpptools-linux.vsix"
            dest "${buildDir}/test-extensions/cpptools-0.26.1.vsix"
        }
        download {
            src "https://github.com/OmniSharp/omnisharp-vscode/releases/download/v1.21.6/csharp-1.21.6.vsix"
            dest "${buildDir}/test-extensions/csharp-1.21.6.vsix"
        }
        download {
            src "https://github.com/redhat-developer/vscode-java/releases/download/v0.47.0/redhat.java-0.47.0.vsix"
            dest "${buildDir}/test-extensions/java-0.47.0.vsix"
        }
        download {
            src "https://github.com/HookyQR/VSCodeBeautify/releases/download/v0.1.3/beautify-0.1.3.vsix"
            dest "${buildDir}/test-extensions/beautify-0.1.3.vsix"
        }
        download {
            src "https://github.com/eamodio/vscode-gitlens/releases/download/v10.0.1/gitlens-10.0.1.vsix"
            dest "${buildDir}/test-extensions/gitlens-10.0.1.vsix"
        }
        download {
            src "https://github.com/eamodio/vscode-gitlens/releases/download/v10.1.0/gitlens-10.1.0.vsix"
            dest "${buildDir}/test-extensions/gitlens-10.1.0.vsix"
        }
        download {
            src "https://github.com/eamodio/vscode-gitlens/releases/download/v10.1.1/gitlens-10.1.1.vsix"
            dest "${buildDir}/test-extensions/gitlens-10.1.1.vsix"
        }
        download {
            src "https://github.com/vuejs/vetur/releases/download/v0.22.5/vetur-0.22.5.vsix"
            dest "${buildDir}/test-extensions/vetur-0.22.5.vsix"
        }
        download {
            src "https://github.com/vuejs/vetur/releases/download/v0.22.6/vetur-0.22.6.vsix"
            dest "${buildDir}/test-extensions/vetur-0.22.6.vsix"
        }
        download {
            src "https://github.com/Wscats/omi-snippets/releases/download/2.03/eno-2.0.3.vsix"
            dest "${buildDir}/test-extensions/eno-2.0.3.vsix"
        }
        download {
            src "https://github.com/microsoft/vscode-docker/releases/download/v0.8.1/vscode-docker-0.8.1.vsix"
            dest "${buildDir}/test-extensions/docker-0.8.1.vsix"
        }
        download {
            src "https://github.com/microsoft/vscode-docker/releases/download/v0.8.2/vscode-docker-0.8.2.vsix"
            dest "${buildDir}/test-extensions/docker-0.8.2.vsix"
        }
        download {
            src "https://github.com/ritwickdey/vscode-live-server/releases/download/v5.6.1/LiveServer-v5.6.1-linux.vsix"
            dest "${buildDir}/test-extensions/live-server-5.6.1.vsix"
        }
        download {
            src "https://github.com/felixfbecker/vscode-php-intellisense/releases/download/v2.3.10/php-intellisense.vsix"
            dest "${buildDir}/test-extensions/php-2.3.10.vsix"
        }
        download {
            src "https://github.com/felixfbecker/vscode-php-intellisense/releases/download/v2.3.11/php-intellisense.vsix"
            dest "${buildDir}/test-extensions/php-2.3.11.vsix"
        }
        download {
            src "https://github.com/felixfbecker/vscode-php-intellisense/releases/download/v2.3.12/php-intellisense.vsix"
            dest "${buildDir}/test-extensions/php-2.3.12.vsix"
        }
        download {
            src "https://github.com/felixfbecker/vscode-php-intellisense/releases/download/v2.3.13/php-intellisense.vsix"
            dest "${buildDir}/test-extensions/php-2.3.13.vsix"
        }
        download {
            src "https://github.com/formulahendry/vscode-code-runner/releases/download/0.9.14/code-runner-0.9.14.vsix"
            dest "${buildDir}/test-extensions/code-runner-0.9.14.vsix"
        }
        download {
            src "https://github.com/redhat-developer/vscode-yaml/releases/download/0.4.0/redhat.vscode-yaml-0.4.0.vsix"
            dest "${buildDir}/test-extensions/yaml-0.4.0.vsix"
        }
        download {
            src "https://github.com/redhat-developer/vscode-yaml/releases/download/0.5.3-beta/vscode-yaml.vsix"
            dest "${buildDir}/test-extensions/yaml-0.5.3-beta.vsix"
        }
        download {
            src "https://github.com/microsoft/vscode-go/releases/download/0.11.6/Go-0.11.6.vsix"
            dest "${buildDir}/test-extensions/go-0.11.6.vsix"
        }
        download {
            src "https://github.com/microsoft/vscode-go/releases/download/0.11.7/Go-0.11.7.vsix"
            dest "${buildDir}/test-extensions/go-0.11.7.vsix"
        }
        download {
            src "https://github.com/microsoft/vscode-go/releases/download/0.11.8/Go-0.11.8.vsix"
            dest "${buildDir}/test-extensions/go-0.11.8.vsix"
        }
        download {
            src "https://github.com/microsoft/vscode-mssql/releases/download/v1.4.0/mssql-1.4.0-ubuntu.16.04-x64.vsix"
            dest "${buildDir}/test-extensions/sql-server-1.4.0.vsix"
        }
        download {
            src "https://github.com/microsoft/vscode-mssql/releases/download/v1.5.0-alpha.49/mssql-1.7.0-ubuntu.16.04-x64.vsix"
            dest "${buildDir}/test-extensions/sql-server-1.5.0-alpha.49.vsix"
        }
        download {
            src "https://github.com/PowerShell/vscode-powershell/releases/download/v2019.9.0/PowerShell-2019.9.0.vsix"
            dest "${buildDir}/test-extensions/powershell-2019.9.0.vsix"
        }
        download {
            src "https://github.com/PowerShell/vscode-powershell/releases/download/v2019.11.0/PowerShell-2019.11.0.vsix"
            dest "${buildDir}/test-extensions/powershell-2019.11.0.vsix"
        }
        download {
            src "https://github.com/material-theme/vsc-material-theme/releases/download/v30.0/vsc-material-theme-30.0.0.vsix"
            dest "${buildDir}/test-extensions/material-theme-30.0.0.vsix"
        }
        download {
            src "https://github.com/DotJoshJohnson/vscode-xml/releases/download/v2.5.0/xml-2.5.0.vsix"
            dest "${buildDir}/test-extensions/xml-2.5.0.vsix"
        }
        download {
            src "https://github.com/xsburg/vscode-javascript-booster/releases/download/v0.11.0/vscode-javascript-booster-0.11.0.vsix"
            dest "${buildDir}/test-extensions/vscode-javascript-booster-0.11.0.vsix"
        }
        download {
            src "https://github.com/formulahendry/vscode-auto-close-tag/releases/download/0.5.5/auto-close-tag-0.5.5.vsix"
            dest "${buildDir}/test-extensions/auto-close-tag-0.5.5.vsix"
        }
    }
}
