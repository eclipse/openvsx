# =============================================================================
# OpenVSX Secret Detection Configuration
# =============================================================================
# This file configures the secret detection scanner for extension publishing.
# It defines global allowlists and custom detection rules.
#
# Configuration is merged from multiple YAML files (gitleaks rules + this file).
# Later files override earlier ones by rule id. Allowlists are merged additively.
# =============================================================================

allowlist:
  # Files matching these patterns are excluded from secret scanning.
  # Patterns are matched against the full file path within the extension.
  # Use regex syntax (escape dots, use anchors where needed).
  paths:
    # Bundled/minified JavaScript (likely contain false positives from hashes)
    - "bundle\\.js"
    - "chunk\\.js"
    - "webpack"
    - "rollup"
    - "\\.min\\.js"
    - "\\.min\\.css"
    # Build artifacts with hash suffixes (e.g., main-a1b2c3d4.js)
    - "-[A-Za-z0-9_]{6,}\\.(js|css)$"
    - "-[a-f0-9]{8,}\\.js$"
    - "/assets/.*\\.js$"
    # Test files (often contain mock secrets)
    - "\\.test\\."
    - "\\.spec\\."
    # Dependency metadata
    - "-bom_versions\\.xml"

  # If a detected secret matches any of these patterns, it's filtered out.
  regexes:
    # Add patterns here to exclude specific false positive patterns
    # Example: - "^EXAMPLE_[A-Z]+$"

  # If a detected secret contains any of these strings, it's filtered out.
  # These catch common placeholder/example values that aren't real secrets.
  stopwords:
    # Sequential/placeholder patterns
    - "0123456789"
    - "xxxxxx"
    - "..."
    # Common placeholder words
    - "changeme"
    - "default"
    - "dummy"
    - "example"
    - "fake"
    - "insert"
    - "placeholder"
    - "redacted"
    - "replace"
    - "sample"
    - "some"
    - "standard"
    - "test"
    - "your"
    # Common variable/field names (not actual secrets)
    - "username"
    - "user"
    - "password"
    - "pass"
    - "secret"
    - "root"
    - "localhost"
    # Boolean/null literals (often in config examples)
    - "true"
    - "false"
    - "null"

  # Files with these extensions are skipped entirely (fast path check).
  # These are binary files that cannot contain text secrets.
  file-extensions:
    # Images
    - ".png"
    - ".jpg"
    - ".jpeg"
    - ".gif"
    - ".ico"
    - ".svg"
    - ".webp"
    # Fonts
    - ".woff"
    - ".woff2"
    - ".ttf"
    - ".eot"
    - ".otf"
    # Audio/Video
    - ".mp3"
    - ".wav"
    - ".ogg"
    - ".mp4"
    - ".webm"
    - ".avi"
    # Archives
    - ".zip"
    - ".tar"
    - ".gz"
    - ".7z"
    - ".rar"
    # Documents (binary)
    - ".pdf"
    - ".doc"
    - ".docx"
    # Executables/Libraries
    - ".exe"
    - ".dll"
    - ".so"
    - ".dylib"
    # Compiled bytecode
    - ".class"
    - ".jar"
    - ".war"
    - ".pyc"
    - ".pyo"
    - ".o"
    - ".a"
    # Other
    - ".mjs"      # ES modules (often bundled)
    - ".tsv"      # Tab-separated data
    - ".map"      # Source maps (contain encoded data)

  # MIME type patterns to skip (regex, detected via Apache Tika)
  # Use this for content-based detection of binary files without extensions
  mime-types:
    # Executables - Linux/Unix (ELF format)
    - "^application/x-(elf|executable|sharedlib|object|coredump)$"
    # Executables - Windows (PE format)
    - "^application/x-(msdownload|dosexec|msdos-program|ms-installer)$"
    # Executables - macOS (Mach-O format)
    - "^application/x-mach"
    # Archives
    - "^application/(zip|gzip|x-tar|x-bzip2|x-xz|x-7z|x-rar|java-archive|x-archive)"
    - "^application/vnd.rar$"
    # Generic binary
    - "^application/octet-stream$"

# =============================================================================
# Custom Detection Rules
# =============================================================================
# Rules specific to OpenVSX that aren't in the standard gitleaks ruleset.
#
# Each rule requires:
#   id:          Unique identifier for the rule
#   description: Human-readable explanation of what this detects
#   regex:       Pattern to match secrets (use capturing group for the secret)
#   keywords:    Fast-path keywords that must appear before regex is tested
#
# Optional fields:
#   entropy:     Minimum Shannon entropy (0.0-8.0) to filter low-entropy matches
#   secretGroup: Capture group index for the secret value (default: 1 or 0)
#   allowlists:  Rule-specific patterns to exclude known safe matches
# =============================================================================

rules:
  # Detects PATs used to authenticate with the OpenVSX registry.
  # These tokens allow publishing extensions and should never be committed.
  # Format: ovsxat_<uuid> or ovsxp_<uuid> (also matches with hyphen separator)
  - id: openvsx-pat-prefixed
    description: "Detected an OpenVSX Personal Access Token with explicit prefix, risking unauthorized extension publishing."
    regex: "\\b((?:ovsxat|ovsxp)[_-][a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})\\b"
    entropy: 2.5
    keywords:
      - ovsxat_
      - ovsxp_
